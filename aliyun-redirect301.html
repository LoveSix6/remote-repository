<!DOCTYPE html>
<html lang="zh-CN">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>阿里云EdgeScript生成器 - 多域名与单域名重定向</title>
        <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
        <style>
            :root {
                --primary-color: #007AFF;
                --primary-light: #409CFF;
                --primary-dark: #0056CC;
                --secondary-color: #5856D6;
                --success-color: #34C759;
                --warning-color: #FF9500;
                --danger-color: #FF3B30;
                --background-light: rgba(255, 255, 255, 0.7);
                --background-dark: rgba(0, 0, 0, 0.1);
                --glass-border: rgba(255, 255, 255, 0.18);
                --text-primary: #1D1D1F;
                --text-secondary: #86868B;
                --text-tertiary: #8E8E93;
                --shadow-light: 0 8px 32px rgba(0, 122, 255, 0.1);
                --shadow-heavy: 0 20px 60px rgba(0, 0, 0, 0.15);
                --radius-small: 14px;
                --radius-medium: 20px;
                --radius-large: 28px;
                --transition-smooth: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
                --transition-bounce: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', sans-serif;
                min-height: 100vh;
                padding: 20px;
                background: linear-gradient(135deg,
                        rgba(242, 242, 247, 0.95) 0%,
                        rgba(229, 229, 234, 0.95) 50%,
                        rgba(209, 209, 214, 0.95) 100%);
                color: var(--text-primary);
                position: relative;
                overflow-x: hidden;
            }

            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background:
                    radial-gradient(circle at 20% 80%, rgba(0, 122, 255, 0.15) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(88, 86, 214, 0.15) 0%, transparent 50%),
                    radial-gradient(circle at 40% 40%, rgba(52, 199, 89, 0.1) 0%, transparent 50%);
                z-index: -1;
                animation: gradientShift 20s ease infinite alternate;
            }

            @keyframes gradientShift {

                0%,
                100% {
                    transform: scale(1) rotate(0deg);
                }

                50% {
                    transform: scale(1.2) rotate(180deg);
                }
            }

            .container {
                max-width: 1800px;
                margin: 0 auto;
                background: var(--background-light);
                backdrop-filter: blur(40px) saturate(180%);
                -webkit-backdrop-filter: blur(40px) saturate(180%);
                border-radius: var(--radius-large);
                border: 1px solid var(--glass-border);
                box-shadow:
                    var(--shadow-heavy),
                    inset 0 1px 0 rgba(255, 255, 255, 0.6),
                    inset 0 -1px 0 rgba(0, 0, 0, 0.1);
                overflow: hidden;
                position: relative;
                animation: containerEntrance 0.8s cubic-bezier(0.215, 0.610, 0.355, 1) forwards;
                opacity: 0;
                transform: translateY(30px);
            }

            @keyframes containerEntrance {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .header {
                background: linear-gradient(135deg,
                        rgba(0, 122, 255, 0.9) 0%,
                        rgba(88, 86, 214, 0.9) 100%);
                color: white;
                padding: 40px;
                position: relative;
                overflow: hidden;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                min-height: auto;
                padding-bottom: 30px;
            }

            .header::before {
                content: '';
                position: absolute;
                top: -50%;
                left: -50%;
                width: 200%;
                height: 200%;
                background: radial-gradient(circle,
                        rgba(255, 255, 255, 0.1) 0%,
                        transparent 70%);
                opacity: 0.3;
                animation: pulse 8s ease-in-out infinite;
            }

            @keyframes pulse {

                0%,
                100% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.1);
                }
            }

            .header-content {
                position: relative;
                z-index: 2;
                flex: 1;
                width: 100%;
                margin-bottom: 20px;
            }

            .header h1 {
                font-size: 40px;
                margin-bottom: 12px;
                font-weight: 700;
                letter-spacing: -0.5px;
                text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
                animation: textGlow 3s ease-in-out infinite alternate;
            }

            @keyframes textGlow {
                from {
                    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
                }

                to {
                    text-shadow: 0 2px 20px rgba(255, 255, 255, 0.4);
                }
            }

            .header-subtitle {
                font-size: 18px;
                opacity: 0.95;
                margin-bottom: 8px;
                font-weight: 400;
            }

            .header-tag {
                display: inline-block;
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(10px);
                padding: 8px 20px;
                border-radius: 50px;
                font-size: 14px;
                margin-top: 15px;
                border: 1px solid rgba(255, 255, 255, 0.2);
                animation: float 6s ease-in-out infinite;
            }

            @keyframes float {

                0%,
                100% {
                    transform: translateY(0px);
                }

                50% {
                    transform: translateY(-5px);
                }
            }

            /* 检测区域容器 */
            .detection-area {
                position: relative;
                display: flex;
                flex-direction: column;
                align-items: flex-end;
                gap: 20px;
                z-index: 100;
            }

            /* 检测按钮和状态容器 */
            .detect-controls {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            /* iOS风格检测按钮 */
            .detect-btn {
                position: relative;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background: linear-gradient(135deg,
                        rgba(255, 255, 255, 0.25) 0%,
                        rgba(255, 255, 255, 0.1) 100%);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.3);
                color: white;
                font-size: 28px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                box-shadow:
                    0 8px 32px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.4),
                    inset 0 -1px 0 rgba(0, 0, 0, 0.1);
                overflow: hidden;
            }

            .detect-btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: radial-gradient(circle at 30% 30%,
                        rgba(255, 255, 255, 0.4) 0%,
                        transparent 70%);
                opacity: 0.6;
                z-index: 1;
                pointer-events: none;
            }

            .detect-btn::after {
                content: '';
                position: absolute;
                top: -2px;
                left: -2px;
                right: -2px;
                bottom: -2px;
                background: linear-gradient(45deg,
                        var(--primary-color),
                        var(--secondary-color),
                        var(--primary-color));
                background-size: 400% 400%;
                border-radius: 50%;
                z-index: -1;
                opacity: 0;
                animation: borderFlow 3s linear infinite;
                transition: opacity 0.3s ease;
            }

            @keyframes borderFlow {
                0% {
                    background-position: 0% 50%;
                }

                50% {
                    background-position: 100% 50%;
                }

                100% {
                    background-position: 0% 50%;
                }
            }

            .detect-btn:hover::after {
                opacity: 1;
            }

            .detect-btn:hover {
                transform: translateY(-5px) scale(1.1);
                box-shadow:
                    0 15px 40px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.6),
                    inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            }

            .detect-btn.testing {
                animation: pulse 1.5s ease-in-out infinite;
                background: linear-gradient(135deg,
                        rgba(255, 149, 0, 0.3) 0%,
                        rgba(230, 126, 34, 0.2) 100%);
            }

            .detect-btn.disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none !important;
                box-shadow: none !important;
            }

            .detect-btn.disabled:hover {
                transform: none !important;
                box-shadow: none !important;
            }

            /* 检测状态文本 */
            .detect-status {
                color: white;
                font-size: 16px;
                font-weight: 500;
                text-align: center;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
                min-height: 24px;
                opacity: 0.9;
                max-width: 300px;
                word-break: break-word;
                line-height: 1.4;
                padding: 0 10px;
            }

            /* 进度条容器 */
            .progress-container {
                display: none;
                width: 100%;
                max-width: 400px;
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border-radius: 15px;
                padding: 20px;
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }

            .progress-container.show {
                display: block;
                animation: slideIn 0.3s ease-out;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .progress-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
                color: white;
                font-size: 16px;
                font-weight: 500;
            }

            .progress-bar {
                height: 10px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 5px;
                overflow: hidden;
                margin-bottom: 15px;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
                border-radius: 5px;
                width: 0%;
                transition: width 0.3s ease;
            }

            .progress-details {
                display: flex;
                justify-content: space-between;
                color: rgba(255, 255, 255, 0.8);
                font-size: 14px;
            }

            /* 检测统计信息 */
            .test-stats {
                display: none;
                color: white;
                font-size: 14px;
                text-align: center;
                margin-top: 10px;
                opacity: 0.8;
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(5px);
                padding: 10px 20px;
                border-radius: 20px;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .test-stats.show {
                display: block;
                animation: fadeIn 0.5s ease;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }

                to {
                    opacity: 0.8;
                }
            }

            /* 状态码气泡容器 */
            .status-bubbles-container {
                position: static;
                transform: none;
                margin-top: 20px;
                width: 100%;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
                max-width: 100%;
            }

            /* iOS玻璃质感状态码气泡 */
            .status-bubble {
                position: relative;
                width: 80px;
                height: 80px;
                border-radius: 24px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                font-weight: 600;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                backdrop-filter: blur(30px) saturate(180%);
                -webkit-backdrop-filter: blur(30px) saturate(180%);
                border: 1px solid rgba(255, 255, 255, 0.3);
                overflow: hidden;
                box-shadow:
                    0 12px 48px rgba(0, 0, 0, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.4),
                    inset 0 -1px 0 rgba(0, 0, 0, 0.1);
                transform: translateY(20px) scale(0.8);
                opacity: 0;
                animation: bubbleAppear 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
                margin: 5px;
                transform-origin: center;
            }

            /* 水滴质感效果 */
            .status-bubble::before {
                content: '';
                position: absolute;
                top: -20%;
                left: -20%;
                right: -20%;
                bottom: -20%;
                background: radial-gradient(circle at 30% 30%,
                        rgba(255, 255, 255, 0.3) 0%,
                        rgba(255, 255, 255, 0.1) 25%,
                        transparent 70%);
                opacity: 0.8;
                z-index: 1;
                pointer-events: none;
                border-radius: 24px;
            }

            /* 高光效果 */
            .status-bubble::after {
                content: '';
                position: absolute;
                top: 15%;
                left: 15%;
                width: 25%;
                height: 25%;
                background: radial-gradient(circle,
                        rgba(255, 255, 255, 0.9) 0%,
                        rgba(255, 255, 255, 0.3) 60%,
                        transparent 100%);
                border-radius: 50%;
                opacity: 0.7;
                z-index: 2;
                pointer-events: none;
                filter: blur(1px);
            }

            /* 气泡内容 */
            .status-bubble-content {
                position: relative;
                z-index: 3;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 6px;
                width: 100%;
                height: 100%;
            }

            .status-code {
                font-size: 24px;
                font-weight: 800;
                letter-spacing: 0.5px;
                text-shadow:
                    0 2px 4px rgba(0, 0, 0, 0.2),
                    0 1px 0 rgba(255, 255, 255, 0.3);
            }

            .status-count {
                font-size: 13px;
                opacity: 0.9;
                font-weight: 600;
                background: rgba(0, 0, 0, 0.15);
                padding: 3px 10px;
                border-radius: 12px;
                backdrop-filter: blur(5px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                min-width: 30px;
                text-align: center;
            }

            /* 不同状态码的气泡颜色 - iOS风格半透明渐变 */
            .status-bubble.success {
                background: linear-gradient(135deg,
                        rgba(52, 199, 89, 0.25) 0%,
                        rgba(40, 167, 69, 0.2) 50%,
                        rgba(34, 139, 58, 0.15) 100%);
                border-color: rgba(52, 199, 89, 0.35);
            }

            .status-bubble.redirect {
                background: linear-gradient(135deg,
                        rgba(0, 122, 255, 0.25) 0%,
                        rgba(0, 86, 204, 0.2) 50%,
                        rgba(0, 64, 153, 0.15) 100%);
                border-color: rgba(0, 122, 255, 0.35);
            }

            .status-bubble.client-error {
                background: linear-gradient(135deg,
                        rgba(255, 149, 0, 0.25) 0%,
                        rgba(230, 126, 34, 0.2) 50%,
                        rgba(184, 101, 27, 0.15) 100%);
                border-color: rgba(255, 149, 0, 0.35);
            }

            .status-bubble.server-error {
                background: linear-gradient(135deg,
                        rgba(255, 59, 48, 0.25) 0%,
                        rgba(220, 53, 69, 0.2) 50%,
                        rgba(176, 42, 55, 0.15) 100%);
                border-color: rgba(255, 59, 48, 0.35);
            }

            .status-bubble.network-error {
                background: linear-gradient(135deg,
                        rgba(142, 142, 147, 0.25) 0%,
                        rgba(99, 99, 102, 0.2) 50%,
                        rgba(79, 79, 82, 0.15) 100%);
                border-color: rgba(142, 142, 147, 0.35);
            }

            /* 气泡浮动动画 */
            @keyframes bubbleAppear {
                0% {
                    transform: translateY(40px) scale(0.6) rotate(-10deg);
                    opacity: 0;
                }

                70% {
                    transform: translateY(-8px) scale(1.05) rotate(2deg);
                    opacity: 0.9;
                }

                100% {
                    transform: translateY(0) scale(1) rotate(0deg);
                    opacity: 1;
                }
            }

            /* 气泡悬停效果 */
            .status-bubble:hover {
                transform: translateY(-5px) scale(1.05) rotate(2deg);
                box-shadow:
                    0 20px 60px rgba(0, 0, 0, 0.25),
                    inset 0 1px 0 rgba(255, 255, 255, 0.6),
                    inset 0 -1px 0 rgba(0, 0, 0, 0.2);
                z-index: 100;
            }

            .status-bubble:hover::before {
                opacity: 0.9;
                animation: waterEffect 2s ease-in-out infinite;
            }

            @keyframes waterEffect {

                0%,
                100% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.05);
                }
            }

            /* 冒泡动画延迟 */
            .status-bubble:nth-child(1) {
                animation-delay: 0.1s;
            }

            .status-bubble:nth-child(2) {
                animation-delay: 0.3s;
            }

            .status-bubble:nth-child(3) {
                animation-delay: 0.5s;
            }

            .status-bubble:nth-child(4) {
                animation-delay: 0.7s;
            }

            .status-bubble:nth-child(5) {
                animation-delay: 0.9s;
            }

            .status-bubble:nth-child(6) {
                animation-delay: 1.1s;
            }

            .status-bubble:nth-child(7) {
                animation-delay: 1.3s;
            }

            .status-bubble:nth-child(8) {
                animation-delay: 1.5s;
            }

            .status-bubble:nth-child(9) {
                animation-delay: 1.7s;
            }

            .status-bubble:nth-child(10) {
                animation-delay: 1.9s;
            }

            /* iOS风格模态框 */
            .status-modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(20px) saturate(180%);
                -webkit-backdrop-filter: blur(20px) saturate(180%);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                opacity: 0;
                transition: opacity 0.3s ease;
                padding: 20px;
                overflow-y: auto;
            }

            .status-modal-overlay.show {
                display: flex;
                opacity: 1;
                animation: modalFadeIn 0.3s ease-out;
            }

            @keyframes modalFadeIn {
                from {
                    opacity: 0;
                    backdrop-filter: blur(0px);
                }

                to {
                    opacity: 1;
                    backdrop-filter: blur(20px) saturate(180%);
                }
            }

            .status-modal {
                width: 90%;
                max-width: 800px;
                max-height: 85vh;
                /* 从 80vh 改为 85vh，留出更多空间 */
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(40px) saturate(200%);
                -webkit-backdrop-filter: blur(40px) saturate(200%);
                border-radius: var(--radius-large);
                border: 1px solid var(--glass-border);
                box-shadow:
                    0 30px 60px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.6);
                overflow: hidden;
                display: flex;
                flex-direction: column;
                animation: modalSlideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                margin: auto;
                /* 添加这个确保居中 */
                position: relative
            }

            @keyframes modalSlideUp {
                from {
                    opacity: 0;
                    transform: translateY(20px) scale(0.95);
                }

                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            .status-modal-header {
                padding: 25px 30px;
                background: linear-gradient(135deg,
                        rgba(255, 255, 255, 0.9) 0%,
                        rgba(255, 255, 255, 0.7) 100%);
                border-bottom: 1px solid var(--glass-border);
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: relative;
            }

            .status-modal-header::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 1px;
                background: linear-gradient(90deg,
                        transparent,
                        var(--primary-color),
                        transparent);
                opacity: 0.3;
            }

            .status-modal-header h3 {
                font-size: 22px;
                font-weight: 600;
                color: var(--text-primary);
                margin: 0;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .close-modal {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: rgba(0, 0, 0, 0.05);
                backdrop-filter: blur(10px);
                border: 1px solid var(--glass-border);
                color: var(--text-secondary);
                font-size: 24px;
                line-height: 1;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
            }

            .close-modal:hover {
                background: rgba(0, 0, 0, 0.1);
                color: var(--text-primary);
                transform: rotate(90deg);
            }

            .status-modal-content {
                flex: 1;
                padding: 30px;
                overflow-y: auto;
                max-height: calc(85vh - 140px);
            }

            /* 链接列表样式 */
            .status-links-container {
                display: grid;
                gap: 15px;
            }

            .status-link-item {
                padding: 20px;
                background: rgba(255, 255, 255, 0.6);
                backdrop-filter: blur(20px);
                border-radius: var(--radius-medium);
                border: 1px solid var(--glass-border);
                display: grid;
                grid-template-columns: 1fr auto;
                gap: 20px;
                align-items: center;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .status-link-item:hover {
                background: rgba(255, 255, 255, 0.8);
                transform: translateX(5px);
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            }

            .link-info {
                flex: 1;
                min-width: 0;
            }

            .link-url {
                font-size: 15px;
                color: var(--text-primary);
                font-weight: 500;
                margin-bottom: 8px;
                word-break: break-all;
                line-height: 1.5;
                font-family: 'SF Mono', Monaco, Consolas, monospace;
            }

            .link-details {
                display: flex;
                gap: 15px;
                align-items: center;
                flex-wrap: wrap;
                font-size: 13px;
            }

            .link-row {
                font-size: 13px;
                padding: 4px 12px;
                border-radius: 20px;
                background: rgba(0, 122, 255, 0.1);
                color: var(--primary-color);
                font-weight: 500;
            }

            .link-original {
                font-size: 13px;
                color: var(--text-tertiary);
                font-family: 'SF Mono', Monaco, Consolas, monospace;
            }

            /* 状态码标签样式 */
            .status-badge {
                width: 100px;
                height: 40px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 700;
                font-size: 16px;
                flex-shrink: 0;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                backdrop-filter: blur(10px);
            }

            .status-badge.success {
                background: linear-gradient(135deg, rgba(52, 199, 89, 0.9), rgba(40, 167, 69, 0.9));
                color: white;
            }

            .status-badge.redirect {
                background: linear-gradient(135deg, rgba(0, 122, 255, 0.9), rgba(0, 86, 204, 0.9));
                color: white;
            }

            .status-badge.client-error {
                background: linear-gradient(135deg, rgba(255, 149, 0, 0.9), rgba(230, 126, 34, 0.9));
                color: white;
            }

            .status-badge.server-error {
                background: linear-gradient(135deg, rgba(255, 59, 48, 0.9), rgba(220, 53, 69, 0.9));
                color: white;
            }

            .status-badge.network-error {
                background: linear-gradient(135deg, rgba(142, 142, 147, 0.9), rgba(99, 99, 102, 0.9));
                color: white;
            }

            /* 空状态提示 */
            .empty-status {
                text-align: center;
                padding: 60px 20px;
                color: var(--text-tertiary);
            }

            .empty-status-icon {
                font-size: 48px;
                margin-bottom: 20px;
                opacity: 0.5;
            }

            .empty-status-text {
                font-size: 16px;
                line-height: 1.6;
            }

            /* 主内容区域 */
            .main-content {
                display: grid;
                grid-template-columns: 1fr;
                gap: 40px;
                padding: 40px;
            }

            .section-title {
                font-size: 28px;
                color: var(--text-primary);
                margin-bottom: 30px;
                padding-bottom: 15px;
                position: relative;
                font-weight: 600;
                letter-spacing: -0.3px;
            }

            .section-title::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                width: 60px;
                height: 4px;
                background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
                border-radius: 2px;
                animation: lineWidth 2s ease infinite alternate;
            }

            @keyframes lineWidth {
                from {
                    width: 60px;
                }

                to {
                    width: 120px;
                }
            }

            /* 卡片样式 */
            .card {
                backdrop-filter: blur(20px) saturate(200%);
                -webkit-backdrop-filter: blur(20px) saturate(200%);
                border-radius: var(--radius-medium);
                padding: 40px;
                border: 1px solid var(--glass-border);
                box-shadow: var(--shadow-light);
                transition: var(--transition-bounce);
                position: relative;
                overflow: hidden;
            }

            .card::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg,
                        transparent,
                        rgba(255, 255, 255, 0.3),
                        transparent);
                transition: left 0.7s ease;
            }

            .card:hover::before {
                left: 100%;
            }

            .card:hover {
                box-shadow:
                    0 25px 50px rgba(0, 122, 255, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.8);
            }

            /* 上传区域 */
            .upload-area {
                border: 2px dashed rgba(0, 122, 255, 0.3);
                border-radius: var(--radius-medium);
                padding: 60px 30px;
                text-align: center;
                background: rgba(255, 255, 255, 0.5);
                backdrop-filter: blur(10px);
                cursor: pointer;
                transition: var(--transition-smooth);
                margin-bottom: 30px;
                position: relative;
                overflow: hidden;
            }

            .upload-area::after {
                content: '';
                position: absolute;
                top: -2px;
                left: -2px;
                right: -2px;
                bottom: -2px;
                background: linear-gradient(45deg,
                        var(--primary-color),
                        var(--secondary-color),
                        var(--primary-color));
                background-size: 400% 400%;
                border-radius: var(--radius-medium);
                z-index: -1;
                opacity: 0;
                pointer-events: none;
                animation: borderFlow 3s linear infinite;
                transition: opacity 0.3s ease;
            }

            .upload-area:hover::after {
                opacity: 1;
            }

            .upload-area:hover .upload-desc {
                color: #fff;
            }

            .upload-area.dragover {
                background: rgba(0, 122, 255, 0.05);
                border-color: var(--primary-color);
                transform: scale(1.02);
            }

            .upload-icon {
                font-size: 80px;
                margin-bottom: 25px;
                display: inline-block;
                animation: iconFloat 3s ease-in-out infinite;
                filter: drop-shadow(0 5px 15px rgba(0, 122, 255, 0.3));
            }

            @keyframes iconFloat {

                0%,
                100% {
                    transform: translateY(0) scale(1);
                }

                50% {
                    transform: translateY(-10px) scale(1.05);
                }
            }

            .upload-title {
                color: var(--text-primary);
                margin-bottom: 15px;
                font-size: 24px;
                font-weight: 600;
            }

            .upload-desc {
                color: var(--text-secondary);
                font-size: 16px;
                margin-bottom: 15px;
                line-height: 1.6;
                max-width: 600px;
                margin-left: auto;
                margin-right: auto;
            }

            .drag-text {
                color: var(--primary-color);
                font-weight: 600;
                margin-top: 20px;
                display: block;
                font-size: 14px;
                opacity: 0.8;
                transition: opacity 0.3s ease;
            }

            .upload-area:hover .drag-text {
                opacity: 1;
            }

            /* 文件信息 */
            .file-info {
                background: rgba(255, 255, 255, 0.6);
                backdrop-filter: blur(15px);
                border: 1px solid var(--glass-border);
                border-radius: var(--radius-medium);
                padding: 30px;
                margin-top: 25px;
                display: none;
                animation: slideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            }

            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translateY(20px) scale(0.95);
                }

                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            .file-info.show {
                display: block;
            }

            .file-details {
                margin-bottom: 20px;
                padding-bottom: 20px;
                border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            }

            .file-details strong {
                color: var(--text-primary);
                display: inline-block;
                min-width: 100px;
                font-weight: 600;
            }

            /* 文件图标显示区域 */
            .file-icon-display {
                display: none;
                align-items: center;
                justify-content: center;
                padding: 40px;
                background: rgba(255, 255, 255, 0.6);
                backdrop-filter: blur(15px);
                border: 2px solid rgba(0, 122, 255, 0.3);
                border-radius: var(--radius-medium);
                margin-top: 25px;
                cursor: pointer;
                transition: var(--transition-smooth);
                position: relative;
            }

            .file-icon-display.show {
                display: flex;
            }

            .file-icon-display:hover {
                background: rgba(255, 255, 255, 0.8);
                border-color: var(--primary-color);
                transform: scale(1.02);
            }

            .file-icon-display .excel-icon {
                font-size: 60px;
                margin-right: 20px;
                filter: drop-shadow(0 5px 15px rgba(0, 122, 255, 0.3));
            }

            .file-icon-display .file-name {
                font-size: 18px;
                font-weight: 600;
                color: var(--text-primary);
                max-width: 400px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .file-icon-display .delete-hint {
                position: absolute;
                top: 10px;
                right: 10px;
                font-size: 12px;
                color: var(--danger-color);
                background: rgba(255, 59, 48, 0.1);
                padding: 5px 10px;
                border-radius: 10px;
                font-weight: 500;
            }

            .upload-area.collapsed {
                display: none;
            }

            /* 处理按钮样式 */
            .process-btn {
                background: linear-gradient(135deg,
                        var(--primary-color) 0%,
                        var(--secondary-color) 100%);
                color: white;
                border: none;
                padding: 20px 50px;
                border-radius: 50px;
                font-size: 18px;
                font-weight: 600;
                cursor: pointer;
                width: 100%;
                margin-top: 30px;
                transition: var(--transition-bounce);
                position: relative;
                overflow: hidden;
                letter-spacing: 0.5px;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            }

            .process-btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg,
                        transparent,
                        rgba(255, 255, 255, 0.4),
                        transparent);
                transition: left 0.7s ease;
            }

            .process-btn:hover::before {
                left: 100%;
            }

            .process-btn:hover {
                transform: translateY(-5px) scale(1.02);
                box-shadow:
                    0 15px 30px rgba(0, 122, 255, 0.3),
                    0 0 0 5px rgba(0, 122, 255, 0.1);
            }

            .process-btn:active {
                transform: translateY(-2px) scale(0.98);
            }

            .process-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none !important;
                box-shadow: none !important;
            }

            /* 加载动画 */
            .loading {
                display: none;
                text-align: center;
                padding: 40px;
            }

            .loading.show {
                display: block;
            }

            .spinner {
                width: 60px;
                height: 60px;
                margin: 0 auto 20px;
                position: relative;
            }

            .spinner::before,
            .spinner::after {
                content: '';
                position: absolute;
                border-radius: 50%;
                animation: spinner 2s linear infinite;
            }

            .spinner::before {
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg,
                        transparent 30%,
                        var(--primary-color) 100%);
                box-shadow: 0 0 20px rgba(0, 122, 255, 0.3);
            }

            .spinner::after {
                width: 85%;
                height: 85%;
                background: rgba(255, 255, 255, 0.9);
                top: 7.5%;
                left: 7.5%;
            }

            @keyframes spinner {
                to {
                    transform: rotate(360deg);
                }
            }

            /* 错误信息 */
            .error-message {
                background: linear-gradient(135deg,
                        rgba(255, 59, 48, 0.1) 0%,
                        rgba(255, 59, 48, 0.05) 100%);
                backdrop-filter: blur(20px);
                color: var(--danger-color);
                padding: 20px 25px;
                border-radius: var(--radius-medium);
                margin-top: 25px;
                display: none;
                border: 1px solid rgba(255, 59, 48, 0.2);
                animation: shakeError 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
            }

            @keyframes shakeError {

                10%,
                90% {
                    transform: translateX(-1px);
                }

                20%,
                80% {
                    transform: translateX(2px);
                }

                30%,
                50%,
                70% {
                    transform: translateX(-3px);
                }

                40%,
                60% {
                    transform: translateX(3px);
                }
            }

            .error-message.show {
                display: block;
            }

            /* 结果区域 */
            .result-area {
                background: rgba(255, 255, 255, 0.5);
                backdrop-filter: blur(20px);
                border: 1px solid var(--glass-border);
                margin-top: 40px;
                overflow: hidden;
                display: none;
                animation: cardEntrance 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }

            @keyframes cardEntrance {
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            .result-area.show {
                display: block;
                animation: cardEntrance 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            }

            .result-header {
                background: linear-gradient(135deg,
                        rgba(255, 255, 255, 0.8) 0%,
                        rgba(255, 255, 255, 0.6) 100%);
                padding: 25px 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 1px solid var(--glass-border);
            }

            .result-header h3 {
                font-size: 20px;
                font-weight: 600;
                color: var(--text-primary);
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .result-header h3::before {
                content: '✦';
                color: var(--primary-color);
                font-size: 24px;
            }

            .result-buttons {
                display: flex;
                gap: 10px;
                align-items: center;
            }

            .preview-btn {
                background: rgba(255, 255, 255, 0.6);
                backdrop-filter: blur(10px);
                color: var(--secondary-color);
                border: 1px solid var(--glass-border);
                padding: 12px 25px;
                border-radius: 50px;
                cursor: pointer;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 10px;
                transition: var(--transition-smooth);
            }

            .preview-btn:hover {
                background: var(--secondary-color);
                color: white;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(88, 86, 214, 0.3);
            }

            .copy-btn {
                background: rgba(255, 255, 255, 0.6);
                backdrop-filter: blur(10px);
                color: var(--primary-color);
                border: 1px solid var(--glass-border);
                padding: 12px 25px;
                border-radius: 50px;
                cursor: pointer;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 10px;
                transition: var(--transition-smooth);
                font-size: 14px;
            }

            .copy-btn:hover {
                background: rgba(0, 122, 255, 0.1);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 122, 255, 0.2);
            }

            .copy-btn.copied {
                background: var(--success-color);
                color: white;
                border-color: var(--success-color);
            }

            .code-container {
                padding: 30px;
                background: rgba(30, 30, 30, 0.9);
                backdrop-filter: blur(20px);
                color: #f0f0f0;
                font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
                font-size: 15px;
                line-height: 1.7;
                overflow-x: auto;
                max-height: 500px;
                overflow-y: auto;
                position: relative;
                transition: max-height 0.5s ease, padding 0.5s ease;
            }

            .code-container.collapsed {
                max-height: 0;
                padding: 0 30px;
                overflow: hidden;
            }

            .code-container::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 1px;
                background: linear-gradient(90deg,
                        transparent,
                        rgba(255, 255, 255, 0.1),
                        transparent);
            }

            .code-keyword {
                color: #FF7AB2;
                font-weight: 600;
            }

            .code-string {
                color: #B5E8A5;
            }

            .code-comment {
                color: #7A7A7A;
                font-style: italic;
            }

            .code-function {
                color: #79C0FF;
            }

            .code-operator {
                color: #FF967D;
            }

            /* 返回按钮容器 */
            .back-button-container {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 20px;
                margin-top: 20px;
            }

            .back-button-container.show {
                display: flex;
            }

            .back-btn {
                background: linear-gradient(135deg,
                        var(--primary-color) 0%,
                        var(--primary-dark) 100%);
                color: white;
                border: none;
                padding: 12px 30px;
                font-size: 16px;
                font-weight: 600;
                border-radius: var(--radius-medium);
                cursor: pointer;
                transition: var(--transition-smooth);
                box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .back-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(0, 122, 255, 0.4);
            }

            .back-btn:active {
                transform: translateY(0);
            }

            /* 语言子域名结果容器 */
            #languageResultContainer {
                margin-top: 40px;
            }

            /* 说明区域 */
            .instructions {
                background: linear-gradient(135deg,
                        rgba(255, 255, 255, 0.4) 0%,
                        rgba(255, 255, 255, 0.2) 100%);
                backdrop-filter: blur(20px);
                border: 1px solid var(--glass-border);
                padding: 35px;
                margin-top: 40px;
                position: relative;
                overflow: hidden;
            }

            .instructions::before {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                width: 100px;
                height: 100px;
                background: radial-gradient(circle at top right,
                        rgba(0, 122, 255, 0.1),
                        transparent 70%);
                pointer-events: none;
            }

            .instructions h4 {
                color: var(--text-primary);
                margin-bottom: 25px;
                font-size: 20px;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 15px;
            }

            .instructions h4::before {
                content: '📘';
                font-size: 24px;
                filter: drop-shadow(0 2px 4px rgba(0, 122, 255, 0.2));
            }

            .instructions ul {
                margin-left: 25px;
                color: var(--text-secondary);
            }

            .instructions li {
                margin-bottom: 15px;
                line-height: 1.7;
                position: relative;
                padding-left: 10px;
                transition: transform 0.3s ease;
            }

            .instructions li:hover {
                transform: translateX(5px);
            }

            .instructions li::before {
                content: '→';
                position: absolute;
                left: -20px;
                color: var(--primary-color);
                font-weight: bold;
                transition: transform 0.3s ease;
            }

            .instructions li:hover::before {
                transform: translateX(5px);
            }

            /* 标签样式 */
            .type-tag {
                display: inline-flex;
                align-items: center;
                background: linear-gradient(135deg,
                        var(--primary-color) 0%,
                        var(--secondary-color) 100%);
                color: white;
                padding: 6px 16px;
                border-radius: 50px;
                font-size: 12px;
                font-weight: 600;
                margin-left: 15px;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                animation: tagPulse 2s ease-in-out infinite;
            }

            @keyframes tagPulse {

                0%,
                100% {
                    opacity: 1;
                }

                50% {
                    opacity: 0.7;
                }
            }

            /* 响应式调整 */
            @media (max-width: 1200px) {
                .status-bubbles-container {
                    max-width: 350px;
                }

                .status-bubble {
                    width: 70px;
                    height: 70px;
                }

                .status-code {
                    font-size: 20px;
                }
            }

            @media (max-width: 992px) {
                .detection-area {
                    align-items: center;
                }

                .detect-controls {
                    flex-direction: row;
                    justify-content: center;
                    gap: 20px;
                }

                .progress-container {
                    max-width: 100%;
                }
            }

            @media (max-width: 768px) {
                .main-content {
                    padding: 25px;
                    gap: 25px;
                }

                .header {
                    padding: 30px 25px;
                }

                .header h1 {
                    font-size: 32px;
                }

                .card {
                    padding: 25px;
                }

                .upload-area {
                    padding: 40px 20px;
                }

                .upload-icon {
                    font-size: 60px;
                }

                .status-bubble {
                    width: 65px;
                    height: 65px;
                    border-radius: 20px;
                }

                .status-code {
                    font-size: 18px;
                }

                .status-count {
                    font-size: 12px;
                    padding: 2px 8px;
                }

                .detect-btn {
                    width: 55px;
                    height: 55px;
                    font-size: 24px;
                }

                .detect-status {
                    font-size: 14px;
                }

                .status-link-item {
                    grid-template-columns: 1fr;
                    gap: 15px;
                }

                .status-badge {
                    width: 100%;
                    height: 35px;
                }
            }

            @media (max-width: 576px) {
                .status-bubble {
                    width: 60px;
                    height: 60px;
                    border-radius: 18px;
                }

                .status-code {
                    font-size: 16px;
                }

                .status-count {
                    font-size: 11px;
                }

                .detect-btn {
                    width: 50px;
                    height: 50px;
                    font-size: 22px;
                }

                .detect-status {
                    font-size: 13px;
                }
            }
        </style>
    </head>

    <body>
        <!-- 状态码详情模态框 -->
        <div class="status-modal-overlay" id="statusModalOverlay">
            <div class="status-modal">
                <div class="status-modal-header">
                    <h3 id="statusModalTitle">状态码详情</h3>
                    <button class="close-modal" id="closeModalBtn">×</button>
                </div>
                <div class="status-modal-content">
                    <div class="status-links-container" id="statusLinksContainer"></div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="header">
                <div style="display: flex; justify-content: space-between; width: 100%;">
                    <div class="header-content">
                        <h1>阿里云EdgeScript边缘脚本生成器</h1>
                        <div class="header-subtitle">解析Excel数据，自动生成www和单域名重定向规则</div>
                        <span class="header-tag">EdgeScript · 301重定向 · 自动生成代码</span>
                    </div>
                    <!-- 检测区域 -->
                    <div class="detection-area">
                        <div class="detect-controls">
                            <button class="detect-btn" id="detectBtn" title="检测Excel中的链接状态">
                                🔍
                            </button>
                            <div class="detect-status" id="detectStatus">准备检测</div>
                        </div>
                        <!-- 检测进度条 -->
                        <div class="progress-container" id="progressContainer">
                            <div class="progress-header">
                                <span>检测进度</span>
                                <span id="progressText">0/0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <div class="progress-details">
                                <span>正在检测链接...</span>
                                <span id="currentLink"></span>
                            </div>
                        </div>
                        <!-- 检测统计信息 -->
                        <div class="test-stats" id="testStats">
                            共检测 <span id="totalLinks">0</span> 个链接，
                            成功: <span id="successCount">0</span>,
                            失败: <span id="failedCount">0</span>
                        </div>
                    </div>
                </div>
                <!-- 状态码气泡容器 -->
                <div class="status-bubbles-container" id="statusBubblesContainer"></div>
            </div>
            <div class="main-content">
                <!-- 上传区域容器 -->
                <div class="upload-container" id="uploadContainer">
                    <!-- 上传区域 -->
                    <div class="card">
                        <div class="section-title">
                            Excel文件上传 <span class="type-tag">不处理第一行数据</span>
                        </div>
                        <div class="upload-area" id="dropArea">
                            <div class="upload-icon">📁</div>
                            <h3 class="upload-title">上传Excel文件</h3>
                            <p class="upload-desc">上传Excel文件，自动生成www和单域名重定向代码</p>
                            <p class="upload-desc"><strong>处理规则：</strong>第一列为源URL，第二列为目标URL</p>
                            <span class="drag-text">点击或拖拽Excel文件到此处</span>
                            <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.csv">
                        </div>
                        <div class="file-icon-display" id="fileIconDisplay">
                            <div class="excel-icon">📊</div>
                            <div class="file-name" id="displayFileName"></div>
                            <div class="delete-hint">点击删除重新上传</div>
                        </div>
                        <div class="file-info" id="fileInfo">
                            <div class="file-details">
                                <strong>已选择文件:</strong> <span id="fileName"></span>
                                <br>
                                <strong>文件大小:</strong> <span id="fileSize"></span>
                                <br>
                                <strong>检测到列:</strong> <span id="fileColumns"></span>
                            </div>
                        </div>
                        <button id="processBtn" class="process-btn" disabled>
                            开始处理Excel文件
                        </button>
                        <div class="loading" id="loading">
                            <div class="spinner"></div>
                            正在处理Excel文件，请稍候...
                        </div>
                        <div class="error-message" id="errorMessage"></div>
                    </div>
                    <!-- 说明区域 -->
                    <div class="instructions">
                        <h4>📋 处理说明</h4>
                        <ul>
                            <li>从Excel第二行开始处理数据</li>
                            <li>自动识别Excel需要处理的是单域名还是www还是小语种，可以混合写在Excel表格中</li>
                            <li>处理完成后，点击右上角的🔍按钮检测链接状态</li>
                        </ul>
                    </div>
                </div>
                <!-- 返回按钮 -->
                <div class="back-button-container" id="backButtonContainer"
                     style="display: none; justify-content: space-between; align-items: center;">
                    <button id="backBtn" class="back-btn">
                        ← 返回重新上传
                    </button>
                </div>
            </div>
            <!-- 多域名结果区域 -->
            <div class="result-area" id="multiResultBox">
                <div class="result-header">
                    <h3>www重定向代码</h3>
                    <div class="result-buttons">
                        <button id="multiPreviewBtn" class="preview-btn">
                            预览
                        </button>
                        <button id="multiCopyBtn" class="copy-btn">
                            复制代码
                        </button>
                    </div>
                </div>
                <div class="code-container collapsed" id="multiCodeContainer">
                    <pre id="multiCodeOutput"># 处理完成后，代码将显示在这里...</pre>
                </div>
            </div>
            <!-- 单域名结果区域 -->
            <div class="result-area" id="singleResultBox">
                <div class="result-header">
                    <h3>单域名重定向代码（不带www）</h3>
                    <div class="result-buttons">
                        <button id="singlePreviewBtn" class="preview-btn">
                            预览
                        </button>
                        <button id="singleCopyBtn" class="copy-btn">
                            复制代码
                        </button>
                    </div>
                </div>
                <div class="code-container collapsed" id="singleCodeContainer">
                    <pre id="singleCodeOutput"># 处理完成后，代码将显示在这里...</pre>
                </div>
            </div>
            <!-- 语言子域名代码区域容器 -->
            <div id="languageResultContainer"></div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // 基础DOM元素
                const fileInput = document.getElementById('fileInput');
                const dropArea = document.getElementById('dropArea');
                const fileIconDisplay = document.getElementById('fileIconDisplay');
                const displayFileName = document.getElementById('displayFileName');
                const processBtn = document.getElementById('processBtn');
                const loading = document.getElementById('loading');
                const fileInfo = document.getElementById('fileInfo');
                const multiResultBox = document.getElementById('multiResultBox');
                const singleResultBox = document.getElementById('singleResultBox');
                const multiCopyBtn = document.getElementById('multiCopyBtn');
                const singleCopyBtn = document.getElementById('singleCopyBtn');
                const multiPreviewBtn = document.getElementById('multiPreviewBtn');
                const singlePreviewBtn = document.getElementById('singlePreviewBtn');
                const languageResultContainer = document.getElementById('languageResultContainer');
                const errorMessage = document.getElementById('errorMessage');
                const uploadContainer = document.getElementById('uploadContainer');
                const backButtonContainer = document.getElementById('backButtonContainer');
                const backBtn = document.getElementById('backBtn');

                // 检测相关元素
                const detectBtn = document.getElementById('detectBtn');
                const detectStatus = document.getElementById('detectStatus');
                const progressContainer = document.getElementById('progressContainer');
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                const currentLink = document.getElementById('currentLink');
                const testStats = document.getElementById('testStats');
                const totalLinks = document.getElementById('totalLinks');
                const successCount = document.getElementById('successCount');
                const failedCount = document.getElementById('failedCount');

                // 状态码气泡相关元素
                const statusBubblesContainer = document.getElementById('statusBubblesContainer');
                const statusModalOverlay = document.getElementById('statusModalOverlay');
                const statusModalTitle = document.getElementById('statusModalTitle');
                const statusLinksContainer = document.getElementById('statusLinksContainer');
                const closeModalBtn = document.getElementById('closeModalBtn');

                // 数据变量
                let excelData = null;
                let activeCodeContainer = null;
                let multiDomainHost = null;
                let singleDomainHost = null;
                let languageFullHostMappings = null;

                // 链接检测相关变量
                const CORS_PROXY = 'https://believe.zhahanyu99.workers.dev/?url=';
                const TIMEOUT = 10000; // 10秒超时
                let isTesting = false;
                let testResults = [];
                let testStatsData = {
                    total: 0,
                    completed: 0,
                    success: 0,
                    failed: 0,
                    detailed: {}
                };

                // 初始化拖拽上传
                initializeDragDrop(dropArea, fileInput);
                fileIconDisplay.addEventListener('click', handleDeleteFile);

                // 事件监听
                processBtn.addEventListener('click', processExcel);
                multiCopyBtn.addEventListener('click', () => copyToClipboard('multi'));
                singleCopyBtn.addEventListener('click', () => copyToClipboard('single'));
                multiPreviewBtn.addEventListener('click', () => toggleCodePreview('multi'));
                singlePreviewBtn.addEventListener('click', () => toggleCodePreview('single'));
                backBtn.addEventListener('click', handleBack);
                detectBtn.addEventListener('click', startLinkTest);
                closeModalBtn.addEventListener('click', closeStatusModal);

                // 点击模态框外部关闭
                statusModalOverlay.addEventListener('click', (e) => {
                    if (e.target === statusModalOverlay) {
                        closeStatusModal();
                    }
                });

                // 初始化拖拽上传
                function initializeDragDrop(dropArea, fileInput) {
                    dropArea.addEventListener('click', () => fileInput.click());

                    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                        dropArea.addEventListener(eventName, preventDefaults, false);
                        document.body.addEventListener(eventName, preventDefaults, false);
                    });

                    function preventDefaults(e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }

                    ['dragenter', 'dragover'].forEach(eventName => {
                        dropArea.addEventListener(eventName, highlight, false);
                    });

                    ['dragleave', 'drop'].forEach(eventName => {
                        dropArea.addEventListener(eventName, unhighlight, false);
                    });

                    function highlight(e) {
                        dropArea.classList.add('dragover');
                    }

                    function unhighlight(e) {
                        dropArea.classList.remove('dragover');
                    }

                    dropArea.addEventListener('drop', handleDrop, false);

                    function handleDrop(e) {
                        const dt = e.dataTransfer;
                        const files = dt.files;

                        if (files.length > 0) {
                            handleFile(files[0]);
                        }
                    }

                    fileInput.addEventListener('change', (e) => {
                        if (e.target.files.length) {
                            handleFile(e.target.files[0]);
                        }
                    });
                }

                function handleFile(file) {
                    const fileExt = file.name.split('.').pop().toLowerCase();
                    if (!['xlsx', 'xls', 'csv'].includes(fileExt)) {
                        showError('请选择Excel文件 (.xlsx, .xls, .csv)');
                        return;
                    }

                    processBtn.disabled = false;
                    displayFileInfo(file);
                    displayFileIcon(file);
                    previewExcel(file);

                    // 文件上传后显示检测按钮
                    detectBtn.style.display = 'flex';
                    detectStatus.textContent = '准备检测链接';
                }

                function displayFileIcon(file) {
                    displayFileName.textContent = file.name;
                    dropArea.classList.add('collapsed');
                    fileIconDisplay.classList.add('show');
                }

                function handleDeleteFile() {
                    fileInput.value = '';
                    excelData = null;
                    processBtn.disabled = true;
                    fileInfo.classList.remove('show');
                    dropArea.classList.remove('collapsed');
                    fileIconDisplay.classList.remove('show');
                    clearError();
                    resetTestStats();

                    // 重置检测相关元素
                    detectBtn.style.display = 'none';
                    detectStatus.textContent = '';
                    progressContainer.classList.remove('show');
                    testStats.classList.remove('show');
                    statusBubblesContainer.innerHTML = '';
                }

                function displayFileInfo(file) {
                    const fileName = document.getElementById('fileName');
                    const fileSize = document.getElementById('fileSize');
                    const fileColumns = document.getElementById('fileColumns');

                    if (fileName) fileName.textContent = file.name;
                    if (fileSize) fileSize.textContent = formatFileSize(file.size);
                    if (fileColumns) fileColumns.textContent = '2 列 (源URL, 目标URL)';

                    fileInfo.classList.add('show');
                }

                function previewExcel(file) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });

                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                            excelData = jsonData;

                            // 计算有效链接行数
                            const validLinkRows = excelData.slice(1).filter(row => {
                                const sourceUrl = String(row[0] || '').trim();
                                return sourceUrl;
                            }).length;

                            if (validLinkRows > 650) {
                                showError('Excel中有效链接行数超过650，需要对Excel进行拆分，每个表有效链接行数不能大于660（注意第一行空出来，不解析）');
                                return;
                            }

                            // 更新检测状态
                            const linkCount = validLinkRows;
                            detectStatus.textContent = `发现 ${linkCount} 个链接`;
                            detectBtn.title = `检测 ${linkCount} 个链接`;

                        } catch (error) {
                            showError('读取Excel文件失败: ' + error.message);
                        }
                    };

                    reader.onerror = function () {
                        showError('读取文件失败');
                    };

                    reader.readAsArrayBuffer(file);
                }

                // 链接检测相关函数
                function startLinkTest() {
                    if (!excelData || excelData.length < 2) {
                        showError('没有可检测的链接数据，请先上传Excel文件');
                        return;
                    }

                    const links = extractAllLinks();
                    if (links.length === 0) {
                        showError('未找到需要检测的链接');
                        return;
                    }

                    if (isTesting) return;

                    isTesting = true;
                    testResults = [];
                    resetTestStats();
                    testStatsData.total = links.length;

                    // 更新UI状态
                    detectBtn.classList.add('testing');
                    detectBtn.classList.add('disabled');
                    detectBtn.title = '检测中...';
                    detectStatus.textContent = '正在检测链接...';

                    // 显示进度条
                    progressContainer.classList.add('show');
                    progressFill.style.width = '0%';
                    progressText.textContent = `0/${links.length}`;
                    totalLinks.textContent = links.length;
                    successCount.textContent = '0';
                    failedCount.textContent = '0';
                    testStats.classList.remove('show');

                    // 清空气泡容器
                    statusBubblesContainer.innerHTML = '';

                    // 开始并发检测
                    runConcurrentTests(links);
                }

                async function runConcurrentTests(links) {
                    const CONCURRENT_LIMIT = 8;
                    const batches = [];

                    // 将链接分成批次
                    for (let i = 0; i < links.length; i += CONCURRENT_LIMIT) {
                        batches.push(links.slice(i, i + CONCURRENT_LIMIT));
                    }

                    for (let batchIndex = 0; batchIndex < batches.length; batchIndex++) {
                        const batch = batches[batchIndex];
                        const batchPromises = batch.map(link => {
                            currentLink.textContent = `正在检测: ${truncateText(link.url, 30)}`;
                            return checkUrl(link.url);
                        });

                        try {
                            const batchResults = await Promise.all(batchPromises);

                            // 处理批次结果
                            for (let i = 0; i < batchResults.length; i++) {
                                const result = batchResults[i];

                                // 将原始链接信息添加到结果中
                                const originalLink = links[batchIndex * CONCURRENT_LIMIT + i];
                                result.sourceUrl = originalLink.sourceUrl;
                                result.excelRow = originalLink.rowIndex + 1;
                                result.type = 'Excel链接';

                                testResults.push(result);
                                updateTestStats(result);
                            }

                            // 更新进度
                            const completed = testResults.length;
                            const progress = Math.round((completed / links.length) * 100);
                            progressFill.style.width = `${progress}%`;
                            progressText.textContent = `${completed}/${links.length}`;

                            // 更新统计信息
                            updateStatsDisplay();

                        } catch (error) {
                            console.error('批次检测出错:', error);
                        }

                        // 批次间延迟
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }

                    // 检测完成
                    isTesting = false;
                    detectBtn.classList.remove('testing');
                    detectBtn.classList.remove('disabled');
                    detectBtn.title = '重新检测链接';
                    detectStatus.textContent = `检测完成: ${testStatsData.success} 成功, ${testStatsData.failed} 失败`;

                    // 隐藏进度条，显示统计信息
                    progressContainer.classList.remove('show');
                    testStats.classList.add('show');

                    // 更新状态码气泡
                    updateStatusBubbles();
                }

                function updateTestStats(result) {
                    testStatsData.completed++;

                    if (result.error || (result.status >= 400 && result.status < 600)) {
                        testStatsData.failed++;
                    } else {
                        testStatsData.success++;
                    }

                    const statusCode = String(result.status || '0');
                    if (!testStatsData.detailed[statusCode]) {
                        testStatsData.detailed[statusCode] = 0;
                    }
                    testStatsData.detailed[statusCode]++;
                }

                function updateStatsDisplay() {
                    successCount.textContent = testStatsData.success;
                    failedCount.textContent = testStatsData.failed;
                }

                function resetTestStats() {
                    testStatsData = {
                        total: 0,
                        completed: 0,
                        success: 0,
                        failed: 0,
                        detailed: {}
                    };
                    statusBubblesContainer.innerHTML = '';
                    testStats.classList.remove('show');
                }

                // 更新状态码气泡显示
                function updateStatusBubbles() {
                    statusBubblesContainer.innerHTML = '';

                    if (!testStatsData.detailed || Object.keys(testStatsData.detailed).length === 0) {
                        return;
                    }

                    // 对状态码进行排序
                    const sortedStatusCodes = Object.keys(testStatsData.detailed).sort((a, b) => {
                        return parseInt(a) - parseInt(b);
                    });

                    // 为每个状态码创建气泡
                    sortedStatusCodes.forEach((statusCode, index) => {
                        const count = testStatsData.detailed[statusCode] || 0;

                        if (count > 0) {
                            setTimeout(() => {
                                const config = getStatusBubbleConfig(statusCode);
                                const bubble = createStatusBubble(config, count, index);
                                statusBubblesContainer.appendChild(bubble);
                            }, index * 150 + Math.random() * 100);
                        }
                    });
                }

                // 获取状态码对应的配置
                function getStatusBubbleConfig(statusCode) {
                    const statusNum = parseInt(statusCode);

                    if (statusNum >= 200 && statusNum < 300) {
                        return {
                            type: 'success',
                            statusCode: statusCode,
                            title: '成功',
                            description: `状态码 ${statusCode}`
                        };
                    } else if (statusNum >= 300 && statusNum < 400) {
                        return {
                            type: 'redirect',
                            statusCode: statusCode,
                            title: '重定向',
                            description: `状态码 ${statusCode}`
                        };
                    } else if (statusNum >= 400 && statusNum < 500) {
                        return {
                            type: 'client-error',
                            statusCode: statusCode,
                            title: '客户端错误',
                            description: `状态码 ${statusCode}`
                        };
                    } else if (statusNum >= 500) {
                        return {
                            type: 'server-error',
                            statusCode: statusCode,
                            title: '服务器错误',
                            description: `状态码 ${statusCode}`
                        };
                    } else {
                        return {
                            type: 'network-error',
                            statusCode: statusCode,
                            title: '网络错误',
                            description: `状态码 ${statusCode}`
                        };
                    }
                }

                // 创建状态码气泡
                function createStatusBubble(config, count, index) {
                    const bubble = document.createElement('div');
                    bubble.className = `status-bubble ${config.type}`;
                    bubble.dataset.statusCode = config.statusCode;
                    bubble.dataset.statusType = config.type;
                    bubble.title = `${config.title}: ${count}个链接`;

                    const randomX = Math.random() * 20 - 10;
                    const randomY = Math.random() * 20 - 10;
                    bubble.style.transform = `translate(${randomX}px, ${randomY}px) scale(0.8)`;

                    const content = document.createElement('div');
                    content.className = 'status-bubble-content';

                    const codeSpan = document.createElement('span');
                    codeSpan.className = 'status-code';
                    codeSpan.textContent = config.statusCode;

                    const countSpan = document.createElement('span');
                    countSpan.className = 'status-count';
                    countSpan.textContent = count;

                    content.appendChild(codeSpan);
                    content.appendChild(countSpan);
                    bubble.appendChild(content);

                    // 添加点击事件
                    bubble.addEventListener('click', () => {
                        showStatusModal(config, count);
                    });

                    return bubble;
                }

                // 显示状态码详情模态框
                function showStatusModal(config, count) {
                    const links = testResults.filter(link => {
                        const statusCode = String(link.status || '0');
                        return statusCode === config.statusCode;
                    });

                    statusModalTitle.textContent = `${config.title} (${config.description}) - 共${count}个链接`;

                    if (links.length === 0) {
                        statusLinksContainer.innerHTML = `
                    <div class="empty-status">
                        <div class="empty-status-icon">📭</div>
                        <div class="empty-status-text">没有找到${config.title}的链接</div>
                    </div>
                `;
                    } else {
                        let linksHTML = '';

                        links.forEach(link => {
                            const statusCode = link.status || '0';
                            const statusClass = getStatusClass(link);

                            linksHTML += `
                        <div class="status-link-item">
                            <div class="link-info">
                                <div class="link-url" title="${escapeHtml(link.sourceUrl || link.url)}">
                                    ${escapeHtml(truncateText(link.sourceUrl || link.url, 70))}
                                </div>
                                <div class="link-details">
                                    <span class="link-row">第${link.excelRow}行</span>
                                    ${link.finalUrl && link.finalUrl !== link.sourceUrl ?
                                    `<span class="link-original" title="重定向至">→ ${escapeHtml(truncateText(link.finalUrl, 40))}</span>` : ''}
                                </div>
                            </div>
                            <div class="status-badge ${statusClass}">
                                ${statusCode}
                            </div>
                        </div>
                    `;
                        });

                        statusLinksContainer.innerHTML = linksHTML;
                    }

                    statusModalOverlay.classList.add('show');
                    document.body.style.overflow = 'hidden';
                }

                function getStatusClass(link) {
                    const status = link.status || 0;

                    if (link.error) {
                        return 'network-error';
                    } else if (status >= 200 && status < 300) {
                        return 'success';
                    } else if (status >= 300 && status < 400) {
                        return 'redirect';
                    } else if (status >= 400 && status < 500) {
                        return 'client-error';
                    } else if (status >= 500) {
                        return 'server-error';
                    } else {
                        return 'network-error';
                    }
                }

                function closeStatusModal() {
                    statusModalOverlay.classList.remove('show');
                    document.body.style.overflow = '';
                }

                // URL检测函数
                async function checkUrl(url) {
                    const cleanedUrl = cleanUrl(url);
                    const proxyUrl = CORS_PROXY + encodeURIComponent(cleanedUrl);

                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => {
                            controller.abort();
                        }, TIMEOUT);

                        const response = await fetch(proxyUrl, {
                            method: 'GET',
                            signal: controller.signal,
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            },
                            mode: 'cors',
                            credentials: 'omit'
                        });

                        clearTimeout(timeoutId);

                        if (!response.ok) {
                            throw new Error(`代理服务器返回错误: ${response.status}`);
                        }

                        const data = await response.json();

                        if (data.error) {
                            throw new Error(`代理检测错误: ${data.error}`);
                        }

                        const isRedirect = data.isRedirect || (data.originalStatus >= 300 && data.originalStatus < 400);

                        return {
                            url: cleanedUrl,
                            originalUrl: data.originalUrl || cleanedUrl,
                            finalUrl: data.finalUrl || cleanedUrl,
                            status: data.originalStatus || 0,
                            redirected: isRedirect,
                            location: data.location,
                            isRedirect: isRedirect
                        };

                    } catch (error) {
                        let errorMessage = error.message;
                        let statusCode = 0;

                        if (error.name === 'AbortError') {
                            errorMessage = `请求超时 (超过${TIMEOUT / 1000}秒)`;
                            statusCode = 504;
                        } else if (error.name.includes('TypeError')) {
                            if (error.message.includes('Failed to fetch')) {
                                errorMessage = '网络错误：无法连接到代理服务器';
                            } else {
                                errorMessage = '网络错误或无效URL';
                            }
                            statusCode = 0;
                        } else {
                            errorMessage = '未知错误: ' + error.message;
                            statusCode = 0;
                        }

                        return {
                            url: cleanedUrl,
                            originalUrl: cleanedUrl,
                            finalUrl: null,
                            status: statusCode,
                            redirected: false,
                            location: null,
                            error: errorMessage,
                            errorName: error.name
                        };
                    }
                }

                function cleanUrl(url) {
                    let cleaned = String(url || '').trim();
                    cleaned = cleaned.replace(/\s+/g, '');

                    if (cleaned && !cleaned.startsWith('http://') && !cleaned.startsWith('https://')) {
                        cleaned = 'http://' + cleaned;
                    }

                    return cleaned;
                }

                function extractAllLinks() {
                    const links = [];

                    if (!excelData || excelData.length < 2) {
                        return links;
                    }

                    for (let i = 1; i < excelData.length; i++) {
                        const row = excelData[i] || [];
                        const sourceUrl = String(row[0] || '').trim();

                        if (sourceUrl) {
                            links.push({
                                url: sourceUrl,
                                type: 'Excel链接',
                                sourceUrl: sourceUrl,
                                rowIndex: i
                            });
                        }
                    }

                    return links;
                }

                // 原有的Excel处理函数
                function processExcel() {
                    if (!excelData || excelData.length < 2) {
                        showError('Excel文件数据不足，至少需要2行数据（包含表头）');
                        return;
                    }

                    // 计算有效链接行数
                    const validLinkRows = excelData.slice(1).filter(row => {
                        const sourceUrl = String(row[0] || '').trim();
                        return sourceUrl;
                    }).length;

                    if (validLinkRows > 650) {
                        showError('Excel中有效链接行数超过650，需要对Excel进行拆分，每个表有效链接行数不能大于650（注意第一行空出来，不解析）');
                        return;
                    }

                    loading.classList.add('show');
                    processBtn.disabled = true;
                    clearError();

                    setTimeout(() => {
                        try {
                            const multiResult = processMultiDomainData(excelData);
                            const singleResult = processSingleDomainData(excelData, multiResult.mappings);
                            const languageResult = processLanguageSubdomainData(excelData);

                            displayResult(multiResult, 'multi');
                            displayResult(singleResult, 'single');

                            console.log('www域名有效数据:', multiResult.validCount);
                            console.log('单域名有效数据:', singleResult.validCount);

                            if (multiResult.validCount > 0) {
                                multiResultBox.classList.add('show');
                            }

                            if (singleResult.validCount > 0) {
                                singleResultBox.classList.add('show');
                            }

                            if (languageResult.languageSubdomains && languageResult.languageSubdomains.length > 0) {
                                languageFullHostMappings = languageResult.languageFullHostMappings;
                                displayLanguageResults(languageResult);
                            }

                            uploadContainer.style.display = 'none';
                            backButtonContainer.style.display = 'flex';

                            // 处理完成后更新检测状态
                            const links = extractAllLinks();
                            const linkCount = links.length;
                            detectStatus.textContent = `发现 ${linkCount} 个链接，点击检测`;
                            detectBtn.style.display = 'flex';

                        } catch (error) {
                            showError('处理Excel数据时出错: ' + error.message);
                        } finally {
                            loading.classList.remove('show');
                            processBtn.disabled = false;
                        }
                    }, 500);
                }

                function handleBack() {
                    uploadContainer.style.display = 'block';
                    backButtonContainer.style.display = 'none';

                    multiResultBox.classList.remove('show');
                    singleResultBox.classList.remove('show');

                    languageResultContainer.innerHTML = '';

                    document.getElementById('multiCodeOutput').textContent = '# 处理完成后，代码将显示在这里...';
                    document.getElementById('singleCodeOutput').textContent = '# 处理完成后，代码将显示在这里...';

                    fileInput.value = '';
                    fileInfo.style.display = 'none';
                    dropArea.classList.remove('collapsed');
                    fileIconDisplay.classList.remove('show');
                    processBtn.disabled = true;

                    excelData = null;
                    multiDomainHost = null;
                    singleDomainHost = null;
                    languageFullHostMappings = null;

                    clearError();
                    resetTestStats();

                    // 重置检测相关元素
                    detectStatus.textContent = '';
                    detectBtn.style.display = 'none';
                    detectBtn.classList.remove('testing', 'disabled');
                    progressContainer.classList.remove('show');
                    testStats.classList.remove('show');
                    statusBubblesContainer.innerHTML = '';
                }

                // 处理多域名数据
                function processMultiDomainData(data) {
                    const mappings = [];
                    let processedCount = 0;
                    let validCount = 0;
                    let detectedHost = null;

                    for (let i = 1; i < data.length; i++) {
                        const row = data[i] || [];
                        if (row.length < 2) continue;

                        processedCount++;

                        const col1 = String(row[0] || '').trim();
                        const col2 = String(row[1] || '').trim();

                        if (!col1 || !col2) continue;

                        const { host } = extractHostAndUri(col1);

                        if (!host) continue;

                        const hostParts = host.split('.');
                        if (hostParts.length >= 2) {
                            const firstPart = hostParts[0];
                            if (firstPart !== 'www') {
                                continue;
                            }
                        } else {
                            continue;
                        }

                        if (!detectedHost) {
                            detectedHost = host;
                        }

                        let k = extractPathOnly(col1);
                        let v = extractPathOnly(col2);

                        if (k === null || v === null) continue;

                        if (k === '') k = '/';
                        if (v === '') v = '/';

                        if (k === '/' && v === '/') continue;

                        mappings.push({
                            k,
                            v,
                            sourceUrl: col1,
                            targetUrl: col2
                        });
                        validCount++;
                    }

                    const code = generateMultiDomainCode(mappings);

                    multiDomainHost = detectedHost;

                    return {
                        mappings,
                        code,
                        processedCount,
                        validCount,
                        totalCount: data.length - 1,
                        host: detectedHost
                    };
                }

                function generateMultiDomainCode(mappings) {
                    let code = '';
                    code += 'redirect_uri = [\n';

                    mappings.forEach((item, index) => {
                        const isLast = index === mappings.length - 1;
                        const comma = isLast ? '' : ',';
                        code += `    '${item.k}' = '${item.v}'${comma}\n`;
                    });

                    code += ']\n\n';
                    code += 'def for_func(){\n';
                    code += '    for k, v in redirect_uri{\n';
                    code += '        if eq($uri, k){\n';
                    code += '            rewrite(v, \'redirect\', 301)}\n';
                    code += '        if eq($uri, k){\n';
                    code += '            rewrite(v, \'enhance_redirect\', 301)}\n';
                    code += '    }\n';
                    code += '}\n';
                    code += 'for_func()\n';
                    return code;
                }

                // 处理单域名数据
                function processSingleDomainData(data, multiMappings = []) {
                    const mappings = [];
                    let processedCount = 0;
                    let validCount = 0;
                    let targetHost = null;

                    for (let i = 1; i < data.length; i++) {
                        const row = data[i] || [];
                        if (row.length < 2) continue;

                        processedCount++;

                        const col1 = String(row[0] || '').trim();
                        const col2 = String(row[1] || '').trim();

                        if (!col1 || !col2) continue;

                        const { host, uri } = extractHostAndUri(col1);

                        if (!host || !uri) continue;

                        const targetUrl = col2;

                        const hostParts = host.split('.');
                        if (hostParts.length >= 2) {
                            const firstPart = hostParts[0];
                            if (firstPart === 'www') {
                                continue;
                            }
                            if (/^[a-z]{2}$/.test(firstPart)) {
                                continue;
                            }
                        } else {
                            continue;
                        }

                        if (!targetHost) {
                            targetHost = host;
                        }

                        if (host !== targetHost) {
                            console.warn(`发现不同源域名: ${host} (预期: ${targetHost})`);
                        }

                        const { host: targetHostFromUrl } = extractHostAndUri(targetUrl);
                        const isSameDomain = targetHostFromUrl === host;
                        if (uri === '/' && extractPathOnly(targetUrl) === '/' && isSameDomain) continue;

                        mappings.push({
                            host,
                            uri,
                            targetUrl
                        });
                        validCount++;
                    }

                    if (multiMappings.length > 0) {
                        if (!targetHost) {
                            targetHost = multiDomainHost ? multiDomainHost.substring(4) : null;
                        }

                        multiMappings.forEach(item => {
                            const k = item.k;
                            const v = item.v;

                            if (k === '/' && v === '/') return;

                            const existingMapping = mappings.find(m => m.uri === k);
                            if (!existingMapping) {
                                const singleDomainSourceUrl = item.sourceUrl.replace('www.', '');
                                mappings.push({
                                    host: null,
                                    uri: k,
                                    targetUrl: v,
                                    sourceUrl: singleDomainSourceUrl,
                                    targetFullUrl: item.targetUrl
                                });
                                validCount++;
                            }
                        });
                    }

                    const code = generateSingleDomainCode(mappings, targetHost);

                    singleDomainHost = targetHost;

                    return {
                        mappings,
                        code,
                        processedCount,
                        validCount,
                        totalCount: data.length - 1,
                        host: targetHost
                    };
                }

                function generateSingleDomainCode(mappings, host) {
                    if (!host) {
                        return '';
                    }

                    let code = '';
                    code += 'redirect_uri = [\n';

                    mappings.forEach((item, index) => {
                        const isLast = index === mappings.length - 1;
                        const comma = isLast ? '' : ',';
                        const targetValue = item.targetFullUrl || item.targetUrl;
                        code += `    '${item.uri}' = '${targetValue}'${comma}\n`;
                    });

                    code += ']\n\n';
                    code += 'def process_single_redirects() {\n';
                    code += `    for k, v in redirect_uri {\n`;

                    const wwwHost = host.startsWith('www.') ? host : 'www.' + host;
                    const nonWwwHost = host.startsWith('www.') ? host.substring(4) : host;

                    code += `        if and(eq($host, '${host}'), eq($uri, k)) {\n`;
                    code += `            rewrite(v, \'enhance_redirect\', 301)\n`;
                    code += '        }\n';
                    code += '    }\n';
                    code += '}\n\n';

                    code += 'def redirect_to_www() {\n';
                    code += `    if eq($host, '${nonWwwHost}') {\n`;
                    code += `        rewrite('https://${wwwHost}', 'redirect', 301)\n`;
                    code += '    }\n';
                    code += '}\n\n';
                    code += 'process_single_redirects()\n';
                    code += 'redirect_to_www()\n';
                    return code;
                }

                // 处理语言子域名数据
                function processLanguageSubdomainData(data) {
                    const languageSubdomains = new Map();
                    let processedCount = 0;

                    for (let i = 1; i < data.length; i++) {
                        const row = data[i] || [];
                        if (row.length < 2) continue;

                        processedCount++;

                        const col1 = String(row[0] || '').trim();
                        const col2 = String(row[1] || '').trim();

                        if (!col1 || !col2) continue;

                        const { host, uri } = extractHostAndUri(col1);

                        if (!host || !uri) continue;

                        const targetUrl = col2;

                        const hostParts = host.split('.');
                        if (hostParts.length >= 2) {
                            const firstPart = hostParts[0];
                            if (firstPart === 'www') {
                                continue;
                            }
                            if (!/^[a-z]{2}$/.test(firstPart)) {
                                continue;
                            }
                        } else {
                            continue;
                        }

                        const lang = hostParts[0];

                        if (!languageSubdomains.has(lang)) {
                            languageSubdomains.set(lang, {
                                host: host,
                                mappings: [],
                                targetHost: null
                            });
                        }

                        const langData = languageSubdomains.get(lang);

                        if (!langData.targetHost) {
                            const { host: targetHostFromUrl } = extractHostAndUri(targetUrl);
                            if (targetHostFromUrl) {
                                langData.targetHost = targetHostFromUrl;
                            }
                        }

                        if (uri === '/' && extractPathOnly(targetUrl) === '/') continue;

                        langData.mappings.push({
                            uri,
                            targetUrl
                        });
                    }

                    const languageCodes = {};
                    const languageFullHostMappings = new Map();

                    languageSubdomains.forEach((data, lang) => {
                        const code = generateLanguageSubdomainCode(lang, data.host, data.mappings, data.targetHost);
                        languageCodes[lang] = code;
                        languageFullHostMappings.set(lang, data.host);
                    });

                    return {
                        languageSubdomains: Array.from(languageSubdomains.keys()),
                        languageCodes,
                        languageFullHostMappings,
                        processedCount,
                        totalCount: data.length - 1
                    };
                }

                function generateLanguageSubdomainCode(lang, host, mappings, targetHost) {
                    if (!host) {
                        return '';
                    }

                    if (!targetHost) {
                        return '';
                    }

                    const wwwHost = host.replace(/^[a-z]{2}\./, 'www.');
                    let code = '';

                    if (mappings.length > 0) {
                        code += 'redirect_uri = [\n';

                        mappings.forEach((item, index) => {
                            const isLast = index === mappings.length - 1;
                            const comma = isLast ? '' : ',';
                            code += `    '${item.uri}' = '${item.targetUrl}'${comma}\n`;
                        });

                        code += ']\n\n';
                        code += 'def process_language_redirects() {\n';
                        code += `    for k, v in redirect_uri {\n`;
                        code += `        if and(eq($host, '${host}'), eq($uri, k)) {\n`;
                        code += `            rewrite(v, \'enhance_redirect\', 301)\n`;
                        code += '        }\n';
                        code += '    }\n';
                        code += '}\n\n';
                        code += 'process_language_redirects()\n\n';
                    }

                    return code;
                }

                function extractPathOnly(url) {
                    if (!url) return null;

                    let result = url;

                    if (result.startsWith('http://')) {
                        result = result.substring(7);
                    } else if (result.startsWith('https://')) {
                        result = result.substring(8);
                    }

                    const firstSlashIndex = result.indexOf('/');

                    if (firstSlashIndex !== -1) {
                        result = result.substring(firstSlashIndex);
                    } else {
                        result = '/';
                    }

                    return result;
                }

                function extractHostAndUri(url) {
                    try {
                        let parsedUrl = url;
                        if (!url.startsWith('http://') && !url.startsWith('https://') && !url.startsWith('//')) {
                            parsedUrl = 'http://' + url;
                        } else if (url.startsWith('//')) {
                            parsedUrl = 'http:' + url;
                        }

                        const urlObj = new URL(parsedUrl);
                        const host = urlObj.hostname;
                        const uri = urlObj.pathname || '/';

                        const finalUri = uri === '' ? '/' : uri;

                        return { host, uri: finalUri };
                    } catch (error) {
                        console.error('URL解析失败:', url, error);
                        if (url.includes('://')) {
                            const parts = url.split('://')[1].split('/');
                            const host = parts[0];
                            const uri = '/' + parts.slice(1).join('/');
                            return { host, uri: uri === '/' ? '/' : uri };
                        }
                        return { host: null, uri: null };
                    }
                }

                function displayResult(result, type) {
                    const codeOutput = document.getElementById(`${type}CodeOutput`);

                    if (!codeOutput) {
                        console.error(`代码输出元素未找到: ${type}CodeOutput`);
                        return;
                    }

                    codeOutput.textContent = result.code;
                    highlightCode(type);
                }

                function displayLanguageResults(singleResult) {
                    if (!languageResultContainer) {
                        console.error('语言结果容器未找到');
                        return;
                    }

                    languageResultContainer.innerHTML = '';

                    if (!singleResult.languageSubdomains || singleResult.languageSubdomains.length === 0) {
                        return;
                    }

                    singleResult.languageSubdomains.forEach(lang => {
                        const resultArea = document.createElement('div');
                        resultArea.className = 'result-area show';
                        resultArea.id = `language-${lang}ResultBox`;

                        const header = document.createElement('div');
                        header.className = 'result-header';

                        const title = document.createElement('h3');
                        const languageFullHost = singleResult.languageFullHostMappings ? singleResult.languageFullHostMappings.get(lang) : `${lang}.${singleResult.host}`;
                        title.textContent = `${lang} 语言子域名重定向代码 (${languageFullHost})`;

                        const buttons = document.createElement('div');
                        buttons.className = 'result-buttons';

                        const previewBtn = document.createElement('button');
                        previewBtn.className = 'preview-btn';
                        previewBtn.id = `language-${lang}PreviewBtn`;
                        previewBtn.textContent = '预览';
                        previewBtn.addEventListener('click', () => toggleCodePreview(`language-${lang}`));

                        const copyBtn = document.createElement('button');
                        copyBtn.className = 'copy-btn';
                        copyBtn.id = `language-${lang}CopyBtn`;
                        copyBtn.textContent = '复制代码';
                        copyBtn.addEventListener('click', () => copyLanguageCode(lang));

                        buttons.appendChild(previewBtn);
                        buttons.appendChild(copyBtn);

                        header.appendChild(title);
                        header.appendChild(buttons);

                        const codeContainer = document.createElement('div');
                        codeContainer.className = 'code-container collapsed';
                        codeContainer.id = `language-${lang}CodeContainer`;

                        const pre = document.createElement('pre');
                        pre.id = `language-${lang}CodeOutput`;
                        pre.textContent = singleResult.languageCodes[lang];

                        codeContainer.appendChild(pre);
                        resultArea.appendChild(header);
                        resultArea.appendChild(codeContainer);

                        languageResultContainer.appendChild(resultArea);

                        highlightLanguageCode(lang);
                    });
                }

                function highlightLanguageCode(lang) {
                    const codeElement = document.getElementById(`language-${lang}CodeOutput`);

                    if (!codeElement) {
                        console.error(`语言代码元素未找到: language-${lang}CodeOutput`);
                        return;
                    }

                    let code = codeElement.textContent;

                    code = code
                        .replace(/(redirect_uri|def|for|in|if|eq|and|rewrite|process_language_redirects|redirect_language_to_www|for_func)/g, '<span class="code-keyword">$1</span>')
                        .replace(/(redirect|enhance_redirect)/g, '<span class="code-function">$1</span>')
                        .replace(/'[^']*'/g, '<span class="code-string">$&</span>')
                        .replace(/(\/\/.*)/g, '<span class="code-comment">$1</span>');

                    codeElement.innerHTML = code;
                }

                function highlightCode(type) {
                    const codeElement = document.getElementById(`${type}CodeOutput`);

                    if (!codeElement) {
                        console.error(`代码元素未找到: ${type}CodeOutput`);
                        return;
                    }

                    let code = codeElement.textContent;

                    code = code
                        .replace(/(redirect_uri|def|for|in|if|eq|and|rewrite|process_single_redirects|redirect_to_www|for_func)/g, '<span class="code-keyword">$1</span>')
                        .replace(/(redirect|enhance_redirect)/g, '<span class="code-function">$1</span>')
                        .replace(/'[^']*'/g, '<span class="code-string">$&</span>')
                        .replace(/(\/\/.*)/g, '<span class="code-comment">$1</span>');

                    codeElement.innerHTML = code;
                }

                async function copyToClipboard(type) {
                    const codeElement = document.getElementById(`${type}CodeOutput`);
                    const copyBtn = document.getElementById(`${type}CopyBtn`);

                    if (!codeElement || !copyBtn) {
                        console.error(`复制元素未找到: ${type}CodeOutput 或 ${type}CopyBtn`);
                        return;
                    }

                    const code = codeElement.textContent;

                    try {
                        await navigator.clipboard.writeText(code);

                        const originalText = copyBtn.innerHTML;
                        copyBtn.innerHTML = '✅ 已复制!';
                        copyBtn.classList.add('copied');

                        setTimeout(() => {
                            copyBtn.innerHTML = originalText;
                            copyBtn.classList.remove('copied');
                        }, 2000);

                        let host = null;
                        if (type === 'multi') {
                            host = multiDomainHost;
                        } else if (type === 'single') {
                            host = singleDomainHost;
                        }

                        if (host) {
                            const aliyunUrl = `https://cdn.console.aliyun.com/domain/detail/${host}/edgescript/editor`;
                            window.open(aliyunUrl, '_blank');
                        }
                    } catch (err) {
                        const textArea = document.createElement('textarea');
                        textArea.value = code;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);

                        const originalText = copyBtn.innerHTML;
                        copyBtn.innerHTML = '✅ 已复制!';
                        copyBtn.classList.add('copied');

                        setTimeout(() => {
                            copyBtn.innerHTML = originalText;
                            copyBtn.classList.remove('copied');
                        }, 2000);

                        let host = null;
                        if (type === 'multi') {
                            host = multiDomainHost;
                        } else if (type === 'single') {
                            host = singleDomainHost;
                        }

                        if (host) {
                            const aliyunUrl = `https://cdn.console.aliyun.com/domain/detail/${host}/edgescript/editor`;
                            window.open(aliyunUrl, '_blank');
                        }
                    }
                }

                function toggleCodePreview(type) {
                    const codeContainer = document.getElementById(`${type}CodeContainer`);

                    if (!codeContainer) {
                        console.error(`代码容器未找到: ${type}CodeContainer`);
                        return;
                    }

                    if (activeCodeContainer && activeCodeContainer !== codeContainer) {
                        activeCodeContainer.classList.add('collapsed');
                    }

                    codeContainer.classList.toggle('collapsed');

                    if (codeContainer.classList.contains('collapsed')) {
                        activeCodeContainer = null;
                    } else {
                        activeCodeContainer = codeContainer;
                    }
                }

                async function copyLanguageCode(lang) {
                    const codeElement = document.getElementById(`language-${lang}CodeOutput`);
                    const copyBtn = document.getElementById(`language-${lang}CopyBtn`);

                    if (!codeElement || !copyBtn) {
                        console.error(`语言代码复制元素未找到: language-${lang}CodeOutput 或 language-${lang}CopyBtn`);
                        return;
                    }

                    const code = codeElement.textContent;

                    try {
                        await navigator.clipboard.writeText(code);

                        const originalText = copyBtn.innerHTML;
                        copyBtn.innerHTML = '✅ 已复制!';
                        copyBtn.classList.add('copied');

                        setTimeout(() => {
                            copyBtn.innerHTML = originalText;
                            copyBtn.classList.remove('copied');
                        }, 2000);

                        if (languageFullHostMappings && languageFullHostMappings.has(lang)) {
                            const languageSubdomainHost = languageFullHostMappings.get(lang);
                            const aliyunUrl = `https://cdn.console.aliyun.com/domain/detail/${languageSubdomainHost}/edgescript/editor`;
                            window.open(aliyunUrl, '_blank');
                        } else if (singleDomainHost) {
                            const languageSubdomainHost = `${lang}.${singleDomainHost}`;
                            const aliyunUrl = `https://cdn.console.aliyun.com/domain/detail/${languageSubdomainHost}/edgescript/editor`;
                            window.open(aliyunUrl, '_blank');
                        }
                    } catch (err) {
                        const textArea = document.createElement('textarea');
                        textArea.value = code;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);

                        const originalText = copyBtn.innerHTML;
                        copyBtn.innerHTML = '✅ 已复制!';
                        copyBtn.classList.add('copied');

                        setTimeout(() => {
                            copyBtn.innerHTML = originalText;
                            copyBtn.classList.remove('copied');
                        }, 2000);

                        if (languageFullHostMappings && languageFullHostMappings.has(lang)) {
                            const languageSubdomainHost = languageFullHostMappings.get(lang);
                            const aliyunUrl = `https://cdn.console.aliyun.com/domain/detail/${languageSubdomainHost}/edgescript/editor`;
                            window.open(aliyunUrl, '_blank');
                        } else if (singleDomainHost) {
                            const languageSubdomainHost = `${lang}.${singleDomainHost}`;
                            const aliyunUrl = `https://cdn.console.aliyun.com/domain/detail/${languageSubdomainHost}/edgescript/editor`;
                            window.open(aliyunUrl, '_blank');
                        }
                    }
                }

                function showError(message) {
                    errorMessage.textContent = message;
                    errorMessage.classList.add('show');
                }

                function clearError() {
                    errorMessage.classList.remove('show');
                }

                function formatFileSize(bytes) {
                    if (bytes === 0) return '0 Bytes';

                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));

                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                }

                // 辅助函数
                function escapeHtml(text) {
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                }

                function truncateText(text, maxLength) {
                    if (!text) return '';
                    if (text.length <= maxLength) return text;
                    return text.substring(0, maxLength) + '...';
                }
            });
        </script>
    </body>

</html>